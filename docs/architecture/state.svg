<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1232px" preserveAspectRatio="none" style="width:1483px;height:1232px;background:#1A1A2E;" version="1.1" viewBox="0 0 1483 1232" width="1483px" zoomAndPan="magnify"><defs><filter height="300%" id="f1b6ynaraz0g45" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#7EC8E3" font-family="Arial" font-size="18" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="412" x="539" y="16.708">L.I.M.A. Node — Firmware State Machine</text><text fill="#888888" font-family="Arial" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="155" x="667.5" y="32.0918">nRF52840 / Zephyr RTOS</text><ellipse cx="554" cy="797.9219" fill="#000000" filter="url(#f1b6ynaraz0g45)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#0F3460" filter="url(#f1b6ynaraz0g45)" height="92.1719" rx="12.5" ry="12.5" style="stroke: #4A90D9; stroke-width: 1.5;" width="160" x="655" y="928.9219"/><line style="stroke: #4A90D9; stroke-width: 1.5;" x1="655" x2="815" y1="952.8906" y2="952.8906"/><text fill="#FFFFFF" font-family="Arial" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="33" x="718.5" y="945.0605">BOOT</text><text fill="#AAAAAA" font-family="Arial" font-size="10" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="30" x="660" y="967.1729">BOOT</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="118" x="660" y="978.8135">entry / init Zephyr kernel</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="108" x="660" y="990.4541">entry / start watchdog</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="126" x="660" y="1002.0947">entry / init CryptoCell-310</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="140" x="660" y="1013.7354">entry / load config from flash</text><rect fill="#1A3060" filter="url(#f1b6ynaraz0g45)" height="115.4531" rx="12.5" ry="12.5" style="stroke: #4A90D9; stroke-width: 1.5;" width="162" x="116" y="1105.9219"/><line style="stroke: #4A90D9; stroke-width: 1.5;" x1="116" x2="278" y1="1129.8906" y2="1129.8906"/><text fill="#FFFFFF" font-family="Arial" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="77" x="158.5" y="1122.0605">CALIBRATING</text><text fill="#AAAAAA" font-family="Arial" font-size="10" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="75" x="121" y="1144.1729">CALIBRATING</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="122" x="121" y="1155.8135">entry / warm up BMP280</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="129" x="121" y="1167.4541">entry / warm up MPU6050</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="142" x="121" y="1179.0947">entry / establish BLE baseline</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="138" x="121" y="1190.7354">do / collect baseline pressure</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="120" x="121" y="1202.376">do / collect baseline accel</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="140" x="121" y="1214.0166">exit / store baseline to SRAM</text><rect fill="#0D3320" filter="url(#f1b6ynaraz0g45)" height="92.1719" rx="12.5" ry="12.5" style="stroke: #4A90D9; stroke-width: 1.5;" width="178" x="566" y="42.9219"/><line style="stroke: #4A90D9; stroke-width: 1.5;" x1="566" x2="744" y1="66.8906" y2="66.8906"/><text fill="#FFFFFF" font-family="Arial" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="43" x="633.5" y="59.0605">ARMED</text><text fill="#AAAAAA" font-family="Arial" font-size="10" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="571" y="81.1729">ARMED</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="152" x="571" y="92.8135">entry / enable sensor interrupts</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="130" x="571" y="104.4541">do / monitor BMP280 delta</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="158" x="571" y="116.0947">do / monitor MPU6050 threshold</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="111" x="571" y="127.7354">do / poll BLE heartbeat</text><rect fill="#0F3460" filter="url(#f1b6ynaraz0g45)" height="80.5313" rx="12.5" ry="12.5" style="stroke: #4A90D9; stroke-width: 1.5;" width="199" x="684.5" y="219.9219"/><line style="stroke: #4A90D9; stroke-width: 1.5;" x1="684.5" x2="883.5" y1="243.8906" y2="243.8906"/><text fill="#FFFFFF" font-family="Arial" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="78" x="745" y="236.0605">LIGHT_SLEEP</text><text fill="#AAAAAA" font-family="Arial" font-size="10" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="67" x="689.5" y="258.1729">LIGHT SLEEP</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="179" x="689.5" y="269.8135">entry / disable non-critical peripherals</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="159" x="689.5" y="281.4541">do / maintain sensor IRQ wakeup</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="127" x="689.5" y="293.0947">do / increment sleep timer</text><rect fill="#0A1A3A" filter="url(#f1b6ynaraz0g45)" height="92.1719" rx="12.5" ry="12.5" style="stroke: #4A90D9; stroke-width: 1.5;" width="164" x="908" y="385.9219"/><line style="stroke: #4A90D9; stroke-width: 1.5;" x1="908" x2="1072" y1="409.8906" y2="409.8906"/><text fill="#FFFFFF" font-family="Arial" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="77" x="951.5" y="402.0605">DEEP_SLEEP</text><text fill="#AAAAAA" font-family="Arial" font-size="10" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="913" y="424.1729">DEEP SLEEP</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="91" x="913" y="435.8135">entry / disable BLE</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="144" x="913" y="447.4541">entry / suspend all peripherals</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="104" x="913" y="459.0947">do / RTC wakeup only</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="117" x="913" y="470.7354">exit / reinit BLE on wake</text><rect fill="#2A1A0A" filter="url(#f1b6ynaraz0g45)" height="92.1719" rx="12.5" ry="12.5" style="stroke: #4A90D9; stroke-width: 1.5;" width="214" x="312" y="385.9219"/><line style="stroke: #4A90D9; stroke-width: 1.5;" x1="312" x2="526" y1="409.8906" y2="409.8906"/><text fill="#FFFFFF" font-family="Arial" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="110" x="364" y="402.0605">EVENT_DETECTED</text><text fill="#AAAAAA" font-family="Arial" font-size="10" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="94" x="317" y="424.1729">EVENT DETECTED</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="118" x="317" y="435.8135">entry / latch trigger type</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="122" x="317" y="447.4541">entry / record timestamp</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="147" x="317" y="459.0947">do / log: PRESSURE_BREACH</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="194" x="317" y="470.7354">/ MOTION_DETECTED / DUAL_BREACH</text><rect fill="#2A1A4A" filter="url(#f1b6ynaraz0g45)" height="103.8125" rx="12.5" ry="12.5" style="stroke: #4A90D9; stroke-width: 1.5;" width="214" x="306" y="562.9219"/><line style="stroke: #4A90D9; stroke-width: 1.5;" x1="306" x2="520" y1="586.8906" y2="586.8906"/><text fill="#FFFFFF" font-family="Arial" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="50" x="388" y="579.0605">SIGNING</text><text fill="#AAAAAA" font-family="Arial" font-size="10" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="311" y="601.1729">SIGNING</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="151" x="311" y="612.8135">entry / compose event payload</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="97" x="311" y="624.4541">do / generate nonce</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="194" x="311" y="636.0947">do / ECDSA-P256 sign [CryptoCell-310]</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="99" x="311" y="647.7354">do / encrypt payload</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="124" x="311" y="659.376">exit / signed packet ready</text><rect fill="#0F3460" filter="url(#f1b6ynaraz0g45)" height="92.1719" rx="12.5" ry="12.5" style="stroke: #4A90D9; stroke-width: 1.5;" width="161" x="325.5" y="751.9219"/><line style="stroke: #4A90D9; stroke-width: 1.5;" x1="325.5" x2="486.5" y1="775.8906" y2="775.8906"/><text fill="#FFFFFF" font-family="Arial" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="88" x="362" y="768.0605">TRANSMITTING</text><text fill="#AAAAAA" font-family="Arial" font-size="10" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="84" x="330.5" y="790.1729">TRANSMITTING</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="111" x="330.5" y="801.8135">entry / wake BLE stack</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="141" x="330.5" y="813.4541">do / advertise signed payload</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="124" x="330.5" y="825.0947">do / await BLE TX confirm</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="98" x="330.5" y="836.7354">exit / log TX attempt</text><rect fill="#1A2A1A" filter="url(#f1b6ynaraz0g45)" height="92.1719" rx="12.5" ry="12.5" style="stroke: #4A90D9; stroke-width: 1.5;" width="155" x="464.5" y="928.9219"/><line style="stroke: #4A90D9; stroke-width: 1.5;" x1="464.5" x2="619.5" y1="952.8906" y2="952.8906"/><text fill="#FFFFFF" font-family="Arial" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="70" x="507" y="945.0605">COOLDOWN</text><text fill="#AAAAAA" font-family="Arial" font-size="10" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64" x="469.5" y="967.1729">COOLDOWN</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="135" x="469.5" y="978.8135">entry / start cooldown timer</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="123" x="469.5" y="990.4541">do / suppress new events</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="123" x="469.5" y="1002.0947">do / configurable duration</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="107" x="469.5" y="1013.7354">exit / clear event latch</text><rect fill="#3A0A0A" filter="url(#f1b6ynaraz0g45)" height="92.1719" rx="12.5" ry="12.5" style="stroke: #4A90D9; stroke-width: 1.5;" width="162" x="69" y="928.9219"/><line style="stroke: #4A90D9; stroke-width: 1.5;" x1="69" x2="231" y1="952.8906" y2="952.8906"/><text fill="#FFFFFF" font-family="Arial" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="37" x="131.5" y="945.0605">FAULT</text><text fill="#AAAAAA" font-family="Arial" font-size="10" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="36" x="74" y="967.1729">FAULT</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="138" x="74" y="978.8135">entry / log fault type to flash</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="114" x="74" y="990.4541">entry / assert fault LED</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="107" x="74" y="1002.0947">do / attempt recovery</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="142" x="74" y="1013.7354">do / broadcast fault over BLE</text><rect fill="#2A1A00" filter="url(#f1b6ynaraz0g45)" height="92.1719" rx="12.5" ry="12.5" style="stroke: #4A90D9; stroke-width: 1.5;" width="168" x="979" y="568.9219"/><line style="stroke: #4A90D9; stroke-width: 1.5;" x1="979" x2="1147" y1="592.8906" y2="592.8906"/><text fill="#FFFFFF" font-family="Arial" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="85" x="1020.5" y="585.0605">LOW_BATTERY</text><text fill="#AAAAAA" font-family="Arial" font-size="10" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="79" x="984" y="607.1729">LOW BATTERY</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="138" x="984" y="618.8135">entry / log low battery event</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="148" x="984" y="630.4541">entry / notify gateway via BLE</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="125" x="984" y="642.0947">do / reduce poll frequency</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="144" x="984" y="653.7354">do / disable deep sleep cycling</text><ellipse cx="382" cy="1163.4219" fill="none" filter="url(#f1b6ynaraz0g45)" rx="10" ry="10" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="382.5" cy="1163.9219" fill="#000000" rx="6" ry="6" style="stroke: none; stroke-width: 1.0;"/><path d="M778.5,60.4219 L778.5,84.9219 L744.16,88.9219 L778.5,92.9219 L778.5,116.9844 A0,0 0 0 0 778.5,116.9844 L983.5,116.9844 A0,0 0 0 0 983.5,116.9844 L983.5,70.4219 L973.5,60.4219 L778.5,60.4219 A0,0 0 0 0 778.5,60.4219 " fill="#0D2818" filter="url(#f1b6ynaraz0g45)" style="stroke: #27AE60; stroke-width: 1.0;"/><path d="M973.5,60.4219 L973.5,70.4219 L983.5,70.4219 L973.5,60.4219 " fill="#0D2818" style="stroke: #27AE60; stroke-width: 1.0;"/><text fill="#27AE60" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="112" x="784.5" y="74.7041">Each sensor monitored</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="124" x="784.5" y="86.3447">independently — baro OR</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="106" x="784.5" y="97.9854">IMU alone is sufficient</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="184" x="784.5" y="109.626">to trigger EVENT_DETECTED&lt;/color&gt;</text><path d="M1107.5,403.4219 L1107.5,427.9219 L1072.06,431.9219 L1107.5,435.9219 L1107.5,459.9844 A0,0 0 0 0 1107.5,459.9844 L1288.5,459.9844 A0,0 0 0 0 1288.5,459.9844 L1288.5,413.4219 L1278.5,403.4219 L1107.5,403.4219 A0,0 0 0 0 1107.5,403.4219 " fill="#0D2818" filter="url(#f1b6ynaraz0g45)" style="stroke: #27AE60; stroke-width: 1.0;"/><path d="M1278.5,403.4219 L1278.5,413.4219 L1288.5,413.4219 L1278.5,403.4219 " fill="#0D2818" style="stroke: #27AE60; stroke-width: 1.0;"/><text fill="#27AE60" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="128" x="1113.5" y="417.7041">Entered after configurable</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="103" x="1113.5" y="429.3447">inactivity period from</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="160" x="1113.5" y="440.9854">LIGHT_SLEEP — BLE suspended</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="125" x="1113.5" y="452.626">RTC wakeup only&lt;/color&gt;</text><path d="M266.5,929.4219 L266.5,970.9219 L231.21,974.9219 L266.5,978.9219 L266.5,1020.9063 A0,0 0 0 0 266.5,1020.9063 L429.5,1020.9063 A0,0 0 0 0 429.5,1020.9063 L429.5,939.4219 L419.5,929.4219 L266.5,929.4219 A0,0 0 0 0 266.5,929.4219 " fill="#0D2818" filter="url(#f1b6ynaraz0g45)" style="stroke: #27AE60; stroke-width: 1.0;"/><path d="M419.5,929.4219 L419.5,939.4219 L429.5,939.4219 L419.5,929.4219 " fill="#0D2818" style="stroke: #27AE60; stroke-width: 1.0;"/><text fill="#FF6B35" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="98" x="272.5" y="943.7041">BLE connection lost:</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="98" x="272.5" y="955.3447">queue events locally</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="90" x="272.5" y="966.9854">retry on reconnect</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="10" x="272.5" y="978.626">—</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="84" x="272.5" y="990.2666">Sensor I2C error:</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="86" x="272.5" y="1001.9072">attempt re-init x3</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="142" x="272.5" y="1013.5479">then watchdog reset&lt;/color&gt;</text><path d="M850,946.4219 L850,1002.9844 L1010,1002.9844 L1010,956.4219 L1000,946.4219 L850,946.4219 " fill="#0D2818" filter="url(#f1b6ynaraz0g45)" style="stroke: #27AE60; stroke-width: 1.0;"/><path d="M1000,946.4219 L1000,956.4219 L1010,956.4219 L1000,946.4219 " fill="#0D2818" style="stroke: #27AE60; stroke-width: 1.0;"/><text fill="#27AE60" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="107" x="856" y="960.7041">Prevents event storm</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="115" x="856" y="972.3447">after trigger — duration</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="139" x="856" y="983.9854">configurable per deployment</text><text fill="#AAAAAA" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="133" x="856" y="995.626">e.g. vehicle vs rack&lt;/color&gt;</text><!--MD5=[1e7ed2060c8967abec8e1156481f0193]
link *start to BOOT--><path d="M560.87,805.5719 C580.91,824.9419 640.61,882.6619 684.54,925.1319 " fill="none" id="*start-&gt;BOOT" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="688.21,928.6819,684.5261,919.5479,684.6177,925.2041,678.9616,925.2956,688.21,928.6819" style="stroke: #7EC8E3; stroke-width: 1.0;"/><!--MD5=[14898197c848c22c116660bb85d8942d]
link BOOT to CALIBRATING--><path d="M654.89,1013.7919 C648.88,1016.3019 642.87,1018.7019 637,1020.9219 C514.14,1067.3219 478.72,1064.7819 354,1105.9219 C330.88,1113.5419 306.03,1122.2519 283.07,1130.5119 " fill="none" id="BOOT-&gt;CALIBRATING" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="278.2,1132.2619,288.0239,1132.9622,282.9019,1130.5612,285.3028,1125.4391,278.2,1132.2619" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="62" x="561" y="1061.2041">init complete</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="90" x="547" y="1072.8447">[watchdog armed]</text><!--MD5=[3350fe28b00e7e736a6c3d313cd048b2]
link CALIBRATING to ARMED--><path d="M116,1122.8919 C63.94,1091.2119 6,1041.2719 6,975.9219 C6,259.4219 6,259.4219 6,259.4219 C6,146.1419 380.84,107.1419 560.78,94.9519 " fill="none" id="CALIBRATING-&gt;ARMED" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="565.78,94.6119,556.5268,91.2388,560.7918,94.9549,557.0756,99.2199,565.78,94.6119" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="96" x="8.5" y="612.7041">baseline established</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="99" x="7" y="624.3447">[all sensors nominal]</text><!--MD5=[e9d3ae30f7099aef07b2eeb4862db2b1]
link ARMED to LIGHT_SLEEP--><path d="M659.65,134.9319 C663.26,153.2719 669.65,173.8919 681,189.9219 C687.98,199.7819 696.83,208.6519 706.41,216.5019 " fill="none" id="ARMED-&gt;LIGHT_SLEEP" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="710.55,219.8019,705.9976,211.0683,706.6373,216.6889,701.0167,217.3286,710.55,219.8019" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="95" x="683" y="175.2041">poll interval elapsed</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="97" x="682" y="186.8447">[no event detected]</text><!--MD5=[03da6f50aa8cc8f08748f36052e97428]
link LIGHT_SLEEP to ARMED--><path d="M792.56,219.8819 C794.36,202.0019 793.41,181.2719 784,164.9219 C775.45,150.0619 762.71,137.8819 748.51,127.9719 " fill="none" id="LIGHT_SLEEP-&gt;ARMED" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="744.06,124.9719,749.2768,133.3256,748.2026,127.7717,753.7565,126.6975,744.06,124.9719" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="53" x="810.5" y="175.2041">sensor IRQ</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="86" x="794" y="186.8447">[event candidate]</text><!--MD5=[9b035f6f450eb778f9051c63bc600933]
link LIGHT_SLEEP to DEEP_SLEEP--><path d="M803,301.1919 C813.23,319.5419 827.21,340.5919 844,355.9219 C861.22,371.6419 882.34,384.9719 903.12,395.8319 " fill="none" id="LIGHT_SLEEP-&gt;DEEP_SLEEP" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="907.82,398.2619,901.6469,390.5877,903.3739,395.9745,897.9871,397.7015,907.82,398.2619" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="127" x="845" y="341.2041">sleep timer &gt; configurable</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="106" x="855.5" y="352.8447">threshold [no activity]</text><!--MD5=[e5f1792d156131bfa91b87624a114274]
link DEEP_SLEEP to ARMED--><path d="M986.86,385.8119 C980.02,325.0319 958.24,218.3019 889,164.9219 C842.73,129.2419 816.54,153.0719 761,134.9219 C757.04,133.6319 753.02,132.2419 748.98,130.8019 " fill="none" id="DEEP_SLEEP-&gt;ARMED" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="744.23,129.0719,751.3145,135.9137,748.9273,130.7852,754.0558,128.398,744.23,129.0719" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="60" x="972" y="258.2041">RTC wakeup</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="51" x="976.5" y="269.8447">[poll cycle]</text><!--MD5=[32849012decbec9d767558e842759163]
link ARMED to EVENT_DETECTED--><path d="M565.78,123.6919 C522.55,144.7319 474.05,176.2319 446,219.9219 C415.16,267.9519 411.72,334.8819 413.83,380.4019 " fill="none" id="ARMED-&gt;EVENT_DETECTED" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="414.1,385.5619,417.6325,376.3683,413.8432,380.5685,409.643,376.7792,414.1,385.5619" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="152" x="447" y="252.7041">PRESSURE DELTA &gt; threshold</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="113" x="466.5" y="264.3447">or MOTION &gt; threshold</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="41" x="502.5" y="275.9854">or BOTH</text><!--MD5=[32849012decbec9d767558e842759163]
link ARMED to EVENT_DETECTED--><path d="M565.91,96.0019 C483.87,106.8719 366.45,136.9619 309,219.9219 C272.74,272.2819 320.05,338.1019 363.42,382.1719 " fill="none" id="ARMED-&gt;EVENT_DETECTED-1" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="367.06,385.8419,363.543,376.6424,363.5316,382.2992,357.8748,382.2878,367.06,385.8419" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="76" x="321.5" y="252.7041">NODE TAMPER</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="99" x="310" y="264.3447">detected [case open</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="80" x="319.5" y="275.9854">or voltage spike]</text><!--MD5=[de06acb196c7fad93f485ceb81b52c0d]
link LIGHT_SLEEP to EVENT_DETECTED--><path d="M698.88,300.9519 C645.71,325.6419 576.95,357.5719 520.88,383.6119 " fill="none" id="LIGHT_SLEEP-&gt;EVENT_DETECTED" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="516.19,385.7919,526.0378,385.6463,520.7285,383.6939,522.681,378.3846,516.19,385.7919" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="77" x="642" y="341.2041">sensor IRQ fires</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="89" x="636" y="352.8447">[during light sleep]</text><!--MD5=[de06acb196c7fad93f485ceb81b52c0d]
link LIGHT_SLEEP to EVENT_DETECTED--><path d="M684.17,279.6419 C616.84,293.1819 535.01,312.4219 505,330.9219 C484.16,343.7619 465.73,363.3219 451.32,381.7519 " fill="none" id="LIGHT_SLEEP-&gt;EVENT_DETECTED-1" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="448.13,385.9019,456.7977,381.2252,451.1868,381.9451,450.4669,376.3343,448.13,385.9019" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="76" x="506" y="341.2041">NODE TAMPER</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="43" x="522.5" y="352.8447">detected</text><!--MD5=[e5bbddaf9b2dd902f4b2780e1dd1de14]
link EVENT_DETECTED to SIGNING--><path d="M417.5,478.1319 C416.7,502.2819 415.71,532.2219 414.86,557.8419 " fill="none" id="EVENT_DETECTED-&gt;SIGNING" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="414.69,562.9019,418.996,554.0442,414.8613,557.9048,411.0007,553.7701,414.69,562.9019" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="66" x="431.5" y="518.2041">event latched</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="93" x="418" y="529.8447">[compose payload]</text><!--MD5=[5ee98074af0b0f3919a1794d38ecfef6]
link SIGNING to TRANSMITTING--><path d="M411.01,667.3019 C410.05,692.1819 408.9,721.9519 407.94,746.6819 " fill="none" id="SIGNING-&gt;TRANSMITTING" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="407.74,751.8819,412.0975,743.0494,407.9404,746.8859,404.104,742.7288,407.74,751.8819" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="72" x="411" y="707.2041">payload signed</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="59" x="417.5" y="718.8447">[BLE ready]</text><!--MD5=[a4d3aa7cc5404c48cdb2601d08fd50e9]
link TRANSMITTING to COOLDOWN--><path d="M394.54,844.1419 C392.41,862.3119 393.34,882.7419 403,898.9219 C406.78,905.2619 432,919.5519 459.94,933.9719 " fill="none" id="TRANSMITTING-&gt;COOLDOWN" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="464.45,936.2919,458.2669,928.6258,460.0009,934.0103,454.6164,935.7443,464.45,936.2919" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="59" x="438" y="884.2041">TX complete</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="127" x="404" y="895.8447">[configurable timer starts]</text><!--MD5=[4e8a0b45d40ccd328d59878550597415]
link COOLDOWN to ARMED--><path d="M573.37,928.6419 C593.92,894.5719 617,845.8619 617,798.9219 C617,430.9219 617,430.9219 617,430.9219 C617,327.0019 634.65,206.3619 645.89,140.0419 " fill="none" id="COOLDOWN-&gt;ARMED" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="646.75,134.9719,641.2901,143.1688,645.9072,139.9003,649.1757,144.5174,646.75,134.9719" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="84" x="618" y="518.2041">cooldown expired</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="78" x="621" y="529.8447">[rearm sensors]</text><!--MD5=[de5a8f41b95fb89dc6165251fc26752b]
link CALIBRATING to FAULT--><path d="M123.11,1105.7219 C115.39,1096.6219 108.67,1086.6319 104,1075.9219 C96.82,1059.4319 101.14,1041.5419 109.47,1025.5119 " fill="none" id="CALIBRATING-&gt;FAULT" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="111.92,1021.0419,104.0906,1027.0168,109.5197,1025.4281,111.1085,1030.8572,111.92,1021.0419" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="78" x="105" y="1061.2041">sensor init failed</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="52" x="118" y="1072.8447">[I2C error]</text><!--MD5=[c4437f5638a5f496680e22576295198e]
link FAULT to CALIBRATING--><path d="M176.45,1021.1919 C181.01,1030.7319 185.19,1040.9519 188,1050.9219 C192.46,1066.7619 194.96,1084.3319 196.3,1100.7519 " fill="none" id="FAULT-&gt;CALIBRATING" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="196.68,1105.8019,200.0003,1096.5296,196.3085,1100.8157,192.0224,1097.1239,196.68,1105.8019" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="83" x="195" y="1061.2041">recovery success</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="67" x="203" y="1072.8447">[auto-restart]</text><!--MD5=[d3a42895b9fea6539361370dc3c320a1]
link ARMED to FAULT--><path d="M565.93,101.8019 C423.42,123.3319 160,174.6019 160,259.4219 C160,259.4219 160,259.4219 160,798.9219 C160,840.9819 157.09,888.6319 154.4,923.5719 " fill="none" id="ARMED-&gt;FAULT" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="154.01,928.6419,158.6923,919.9772,154.3957,923.6568,150.7161,919.3602,154.01,928.6419" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="126" x="161" y="524.2041">I2C error / sensor dropout</text><!--MD5=[c44ac9bfcfa830e8ad4f46de1b4bf134]
link TRANSMITTING to FAULT--><path d="M325.3,840.5819 C307.06,850.8619 288.05,862.2819 271,873.9219 C248.31,889.4019 224.74,908.1919 204.49,925.2919 " fill="none" id="TRANSMITTING-&gt;FAULT" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="200.48,928.6819,209.9338,925.9204,204.2964,925.4515,204.7652,919.8141,200.48,928.6819" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="63" x="297.5" y="884.2041">BLE TX failed</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="114" x="272" y="895.8447">[max retries exceeded]</text><!--MD5=[c6c7a83e2cf59d0ca5a77599bc36a2d5]
link ARMED to LOW_BATTERY--><path d="M744.12,129.4119 C749.79,131.4119 755.44,133.2619 761,134.9219 C833.27,156.4619 856.31,141.5319 928,164.9219 C1113.01,225.2819 1211.75,215.6619 1306,385.9219 C1325.8,421.6919 1326.68,442.6519 1306,477.9219 C1272.95,534.2919 1207.05,569.0519 1152.21,589.3019 " fill="none" id="ARMED-&gt;LOW_BATTERY" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="1147.28,591.1019,1157.1039,591.8022,1151.9819,589.4012,1154.3828,584.2791,1147.28,591.1019" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="82" x="1288" y="347.2041">Vbat &lt; threshold</text><!--MD5=[c30916c34778ae1c5bd6d05028f42b2f]
link LOW_BATTERY to ARMED--><path d="M1147.25,597.1919 C1194.41,584.9219 1252.48,564.7219 1297,532.9219 C1375.85,476.6019 1425.24,416.0719 1379,330.9219 C1241.48,77.7019 1039.15,210.1719 761,134.9219 C756.98,133.8319 752.91,132.6219 748.82,131.3219 " fill="none" id="LOW_BATTERY-&gt;ARMED" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="744.03,129.7519,751.3391,136.3532,748.7819,131.3073,753.8278,128.7501,744.03,129.7519" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="79" x="1392" y="341.2041">charge detected</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="75" x="1394" y="352.8447">[Vbat restored]</text><!--MD5=[4262f39dbf72cae45aceba8a4f540da9]
link LIGHT_SLEEP to LOW_BATTERY--><path d="M777.54,301.0919 C772.17,347.5719 770.34,424.9619 806,477.9219 C844.81,535.5519 916.17,570.5219 973.87,590.5419 " fill="none" id="LIGHT_SLEEP-&gt;LOW_BATTERY" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="978.7,592.1919,971.475,585.4987,973.9681,590.5765,968.8903,593.0696,978.7,592.1919" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="82" x="807" y="435.7041">Vbat &lt; threshold</text><!--MD5=[8a5a5227157e0e6b0ec31a1dc213e5ec]
link DEEP_SLEEP to LOW_BATTERY--><path d="M1008.23,478.1319 C1018.73,504.1519 1031.94,536.9119 1042.76,563.7319 " fill="none" id="DEEP_SLEEP-&gt;LOW_BATTERY" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="1044.75,568.6619,1045.0953,558.8191,1042.8808,564.0244,1037.6754,561.8099,1044.75,568.6619" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="82" x="1030" y="524.2041">Vbat &lt; threshold</text><!--MD5=[671009e678a3ff9e6bb500160f705e5f]
link LOW_BATTERY to *end--><path d="M1074.37,661.0919 C1092.21,743.6219 1116.2,919.5819 1027,1020.9219 C939.64,1120.1719 486.04,1155.4519 397.13,1161.4519 " fill="none" id="LOW_BATTERY-&gt;*end" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="392.03,1161.7919,401.2826,1165.1668,397.0183,1161.4498,400.7353,1157.1855,392.03,1161.7919" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="56" x="1088" y="884.2041">Vbat critical</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="55" x="1088.5" y="895.8447">[shutdown]</text><!--MD5=[1b109b12a12fa817ee54ba830baa167a]
link FAULT to *end--><path d="M231.01,1013.9119 C250.24,1024.6219 270.07,1037.1419 287,1050.9219 C324.57,1081.4919 358.82,1128.2919 373.89,1150.2519 " fill="none" id="FAULT-&gt;*end" style="stroke: #7EC8E3; stroke-width: 1.0;"/><polygon fill="#7EC8E3" points="376.81,1154.5419,375.0459,1144.8523,373.9938,1150.4104,368.4356,1149.3583,376.81,1154.5419" style="stroke: #7EC8E3; stroke-width: 1.0;"/><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="69" x="322" y="1061.2041">unrecoverable</text><text fill="#CCCCCC" font-family="Arial" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="83" x="315" y="1072.8447">[watchdog reset]</text><!--MD5=[bf03b80055aa65fbda3737bf1fa02f87]
link COOLDOWN to GMN49--><path d="M586.43,928.7219 C605.6,912.0119 629.37,895.1219 654.5,886.4219 C721.7,863.1619 747.15,863.5919 814.5,886.4219 C849.19,898.1819 881.64,925.0119 903.25,946.0719 " fill="none" id="COOLDOWN-GMN49" style="stroke: #7EC8E3; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--MD5=[36ece240b931e8375ff924f44e454581]
@startuml state
!pragma layout smetana

skinparam {
    BackgroundColor #1a1a2e
    ArrowColor #7EC8E3
    ArrowFontColor #CCCCCC
    ArrowFontSize 10
    DefaultFontName Arial
    DefaultFontColor #E0E0E0
    DefaultFontSize 11
    StateBorderColor #4A90D9
    StateBorderThickness 2
    StateBackgroundColor #0f3460
    StateFontColor #FFFFFF
    StateFontSize 12
    StateAttributeFontColor #AAAAAA
    StateAttributeFontSize 10
    NoteBackgroundColor #0D2818
    NoteBorderColor #27AE60
    NoteFontColor #AAAAAA
    NoteFontSize 10
}

title <size:18><color:#7EC8E3><b>L.I.M.A. Node — Firmware State Machine</b></color></size>\n<size:12><color:#888888>nRF52840 / Zephyr RTOS</color></size>

[*] - -> BOOT

state BOOT #0f3460 : **BOOT**
BOOT : entry / init Zephyr kernel
BOOT : entry / start watchdog
BOOT : entry / init CryptoCell-310
BOOT : entry / load config from flash

state CALIBRATING #1a3060 : **CALIBRATING**
CALIBRATING : entry / warm up BMP280
CALIBRATING : entry / warm up MPU6050
CALIBRATING : entry / establish BLE baseline
CALIBRATING : do / collect baseline pressure
CALIBRATING : do / collect baseline accel
CALIBRATING : exit / store baseline to SRAM

state ARMED #0D3320 : **ARMED**
ARMED : entry / enable sensor interrupts
ARMED : do / monitor BMP280 delta
ARMED : do / monitor MPU6050 threshold
ARMED : do / poll BLE heartbeat

state LIGHT_SLEEP #0f3460 : **LIGHT SLEEP**
LIGHT_SLEEP : entry / disable non-critical peripherals
LIGHT_SLEEP : do / maintain sensor IRQ wakeup
LIGHT_SLEEP : do / increment sleep timer

state DEEP_SLEEP #0a1a3a : **DEEP SLEEP**
DEEP_SLEEP : entry / disable BLE
DEEP_SLEEP : entry / suspend all peripherals
DEEP_SLEEP : do / RTC wakeup only
DEEP_SLEEP : exit / reinit BLE on wake

state EVENT_DETECTED #2a1a0a : **EVENT DETECTED**
EVENT_DETECTED : entry / latch trigger type
EVENT_DETECTED : entry / record timestamp
EVENT_DETECTED : do / log: PRESSURE_BREACH\n/ MOTION_DETECTED / DUAL_BREACH

state SIGNING #2a1a4a : **SIGNING**
SIGNING : entry / compose event payload
SIGNING : do / generate nonce
SIGNING : do / ECDSA-P256 sign [CryptoCell-310]
SIGNING : do / encrypt payload
SIGNING : exit / signed packet ready

state TRANSMITTING #0f3460 : **TRANSMITTING**
TRANSMITTING : entry / wake BLE stack
TRANSMITTING : do / advertise signed payload
TRANSMITTING : do / await BLE TX confirm
TRANSMITTING : exit / log TX attempt

state COOLDOWN #1a2a1a : **COOLDOWN**
COOLDOWN : entry / start cooldown timer
COOLDOWN : do / suppress new events
COOLDOWN : do / configurable duration
COOLDOWN : exit / clear event latch

state FAULT #3a0a0a : **FAULT**
FAULT : entry / log fault type to flash
FAULT : entry / assert fault LED
FAULT : do / attempt recovery
FAULT : do / broadcast fault over BLE

state LOW_BATTERY #2a1a00 : **LOW BATTERY**
LOW_BATTERY : entry / log low battery event
LOW_BATTERY : entry / notify gateway via BLE
LOW_BATTERY : do / reduce poll frequency
LOW_BATTERY : do / disable deep sleep cycling

BOOT - -> CALIBRATING : init complete\n[watchdog armed]

CALIBRATING - -> ARMED : baseline established\n[all sensors nominal]

ARMED - -> LIGHT_SLEEP : poll interval elapsed\n[no event detected]

LIGHT_SLEEP - -> ARMED : sensor IRQ\n[event candidate]
LIGHT_SLEEP - -> DEEP_SLEEP : sleep timer > configurable\nthreshold [no activity]

DEEP_SLEEP - -> ARMED : RTC wakeup\n[poll cycle]

ARMED - -> EVENT_DETECTED : PRESSURE DELTA > threshold\nor MOTION > threshold\nor BOTH
LIGHT_SLEEP - -> EVENT_DETECTED : sensor IRQ fires\n[during light sleep]

EVENT_DETECTED - -> SIGNING : event latched\n[compose payload]

SIGNING - -> TRANSMITTING : payload signed\n[BLE ready]

TRANSMITTING - -> COOLDOWN : TX complete\n[configurable timer starts]

COOLDOWN - -> ARMED : cooldown expired\n[rearm sensors]

CALIBRATING - -> FAULT : sensor init failed\n[I2C error]
ARMED - -> FAULT : I2C error / sensor dropout
TRANSMITTING - -> FAULT : BLE TX failed\n[max retries exceeded]

ARMED - -> LOW_BATTERY : Vbat < threshold
LIGHT_SLEEP - -> LOW_BATTERY : Vbat < threshold
DEEP_SLEEP - -> LOW_BATTERY : Vbat < threshold

LOW_BATTERY - -> ARMED : charge detected\n[Vbat restored]
LOW_BATTERY - -> [*] : Vbat critical\n[shutdown]

FAULT - -> CALIBRATING : recovery success\n[auto-restart]
FAULT - -> [*] : unrecoverable\n[watchdog reset]

ARMED - -> EVENT_DETECTED : NODE TAMPER\ndetected [case open\nor voltage spike]
LIGHT_SLEEP - -> EVENT_DETECTED : NODE TAMPER\ndetected

note right of ARMED
  <color:#27AE60>Each sensor monitored
  independently — baro OR
  IMU alone is sufficient
  to trigger EVENT_DETECTED</color>
end note

note right of DEEP_SLEEP
  <color:#27AE60>Entered after configurable
  inactivity period from
  LIGHT_SLEEP — BLE suspended
  RTC wakeup only</color>
end note

note right of FAULT
  <color:#FF6B35>BLE connection lost:
  queue events locally
  retry on reconnect
  —
  Sensor I2C error:
  attempt re-init x3
  then watchdog reset</color>
end note

note right of COOLDOWN
  <color:#27AE60>Prevents event storm
  after trigger — duration
  configurable per deployment
  e.g. vehicle vs rack</color>
end note

@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 17.0.18+8
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>